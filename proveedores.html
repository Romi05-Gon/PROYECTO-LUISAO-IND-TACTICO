
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Proveedores</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <div class="sidebar">
    <h2>Luisao Panel</h2>
    <div class="menu">
      <a href="index.html">Dashboard</a>
      <a href="productos.html">Productos</a>
      <a href="ventas.html">Ventas</a>
      <a href="clientes.html">Clientes</a>
      <a href="proveedores.html" class="active">Proveedores</a>
      <a href="usuarios.html">Usuarios</a>
    </div>
  </div>

  <div class="content">
    <h1>Proveedores</h1>

    <div class="card">
      <div class="header-actions">
        <button class="btn btn-primary" id="btnNuevo">+ Nuevo Proveedor</button>
        <input id="search" placeholder="Buscar..." />
      </div>

      <table class="table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Nombre</th>
            <th>Telefono</th>
            <th>Email</th>
            <th>Direccion</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- MODAL -->
  <div id="modalForm" class="modal hidden">
    <div class="dialog">
      <h3 id="modalTitle">Nuevo Proveedor</h3>

      <div class="form-row"><label>Nombre</label><input id="nombre"></div>
      <div class="form-row"><label>Telefono</label><input id="telefono"></div>
      <div class="form-row"><label>Email</label><input id="email"></div>
      <div class="form-row"><label>Direccion</label><input id="direccion"></div>

      <div style="text-align:right; margin-top:12px;">
        <button class="btn" onclick="hideModal('modalForm')">Cancelar</button>
        <button class="btn btn-primary" id="saveBtn">Guardar</button>
      </div>
    </div>
  </div>

  <script src="common.js"></script>

  <script>
    const resource = "/api/proveedores";

    document.addEventListener("DOMContentLoaded", () => {
      const tbody = document.querySelector(".table tbody");
      const btnNuevo = document.getElementById("btnNuevo");
      const saveBtn = document.getElementById("saveBtn");
      let editingId = null;

      async function loadAll() {
        const data = await apiFetch(resource);
        render(data);
      }

      function render(items) {
        tbody.innerHTML = "";
        items.forEach(p => {
          const tr = document.createElement("tr");

          tr.innerHTML = `
            <td>${p.id_proveedor}</td>
            <td>${p.nombre}</td>
            <td>${p.telefono}</td>
            <td>${p.email}</td>
            <td>${p.direccion}</td>
            <td>
              <button class="btn" onclick="onEdit(${p.id_proveedor})">Editar</button>
              <button class="btn btn-danger" onclick="onDelete(${p.id_proveedor})">Eliminar</button>
            </td>
          `;

          tbody.appendChild(tr);
        });
      }

      window.onEdit = async (id) => {
        const data = await apiFetch(resource + "/" + id);
        editingId = id;

        document.getElementById("nombre").value = data.nombre;
        document.getElementById("telefono").value = data.telefono;
        document.getElementById("email").value = data.email;
        document.getElementById("direccion").value = data.direccion;

        document.getElementById("modalTitle").innerText = "Editar Proveedor";
        showModal("modalForm");
      };

      window.onDelete = async (id) => {
        if (!confirm("Â¿Eliminar proveedor?")) return;
        await apiFetch(resource + "/" + id, { method: "DELETE" });
        loadAll();
      };

      btnNuevo.addEventListener("click", () => {
        editingId = null;

        document.getElementById("nombre").value = "";
        document.getElementById("telefono").value = "";
        document.getElementById("email").value = "";
        document.getElementById("direccion").value = "";

        document.getElementById("modalTitle").innerText = "Nuevo Proveedor";
        showModal("modalForm");
      });

      saveBtn.addEventListener("click", async () => {
        const payload = {
          nombre: document.getElementById("nombre").value,
          telefono: document.getElementById("telefono").value,
          email: document.getElementById("email").value,
          direccion: document.getElementById("direccion").value
        };

        if (editingId)
          await apiFetch(resource + "/" + editingId, { method: "PUT", body: JSON.stringify(payload) });
        else
          await apiFetch(resource, { method: "POST", body: JSON.stringify(payload) });

        hideModal("modalForm");
        loadAll();
      });

      document.getElementById("search").addEventListener("input", e => {
        const q = e.target.value.toLowerCase();
        Array.from(tbody.querySelectorAll("tr"))
          .forEach(r => r.style.display = r.innerText.toLowerCase().includes(q) ? "" : "none");
      });

      loadAll();
    });
  </script>

</body>
</html>